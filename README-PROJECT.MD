# Food Forum - Post System Documentation

เอกสารนี้อธิบายภาพรวมของระบบจัดการโพสต์ (Post) ซึ่งเป็นฟังก์ชันหลักของแอปพลิเคชัน Food Forum

## ภาพรวม
ระบบนี้ถูกสร้างขึ้นเพื่อให้ผู้ใช้สามารถสร้าง, อ่าน, อัปเดต และลบ (CRUD) โพสต์ที่เกี่ยวกับอาหารได้ รวมถึงสามารถแสดงความคิดเห็นในแต่ละโพสต์ได้ด้วย

---

## 1. โครงสร้างฐานข้อมูล (Database Schema)

ตารางหลักที่เกี่ยวข้องกับระบบนี้คือ `posts` ซึ่งถูกสร้างจากไฟล์ Migration `2025_09_22_023149_create_posts_table.php`

### ตาราง `posts`
| ชื่อคอลัมน์ | ชนิดข้อมูล | คำอธิบาย |
|---|---|---|
| `id` | BigInt (PK) | รหัสเฉพาะของแต่ละโพสต์ |
| `user_id` | BigInt (FK) | รหัสของผู้ใช้ที่เป็นเจ้าของโพสต์ (เชื่อมกับตาราง `users`) |
| `title` | VARCHAR | หัวข้อของโพสต์ |
| `content` | TEXT | เนื้อหาของโพสต์ |
| `image` | VARCHAR | (Nullable) Path สำหรับเก็บไฟล์รูปภาพประกอบโพสต์ |
| `created_at` | TIMESTAMP | วันเวลาที่สร้างโพสต์ |
| `updated_at` | TIMESTAMP | วันเวลาที่อัปเดตโพสต์ล่าสุด |

---

## 2. โมเดล (Models)

โมเดลเป็นตัวแทนของข้อมูลในตารางฐานข้อมูล และกำหนดความสัมพันธ์ระหว่างตารางต่างๆ

### `app/Models/Post.php`
- **หน้าที่:** เป็นโมเดลหลักสำหรับจัดการข้อมูลในตาราง `posts`
- **ความสัมพันธ์ (Relationships):**
    - `user()`: เป็นความสัมพันธ์แบบ `belongsTo` ไปยังโมเดล `User` เพื่อระบุว่าโพสต์นี้เป็นของใคร
    - `comments()`: เป็นความสัมพันธ์แบบ `hasMany` ไปยังโมเดล `Comment` เพื่อดึงความคิดเห็นทั้งหมดของโพสต์นี้

### `app/Models/Comment.php`
- **หน้าที่:** จัดการข้อมูลความคิดเห็นในตาราง `comments`
- **ความสัมพันธ์ (Relationships):**
    - `user()`: ความสัมพันธ์ `belongsTo` ไปยัง `User` เพื่อระบุเจ้าของคอมเมนต์
    - `post()`: ความสัมพันธ์ `belongsTo` ไปยัง `Post` เพื่อระบุว่าคอมเมนต์นี้อยู่ใต้โพสต์ใด

### `app/Models/User.php`
- **หน้าที่:** จัดการข้อมูลผู้ใช้
- **ความสัมพันธ์ (Relationships):**
    - (โดยนัย) มีความสัมพันธ์ `hasMany` ไปยัง `Post` และ `Comment`

---

## 3. Controller

Controller ทำหน้าที่รับ Request จากผู้ใช้, ประมวลผล логика, และส่ง Response กลับไป ซึ่ง Controller หลักของระบบนี้คือ `PostController.php`

### `app/Http/Controllers/PostController.php`
จัดการการทำงานทั้งหมดที่เกี่ยวกับโพสต์ มีเมธอดหลักๆ ดังนี้:
- `index()`: แสดงรายการโพสต์ทั้งหมด โดยมีการทำ Pagination (10 โพสต์ต่อหน้า)
- `create()`: แสดงฟอร์มสำหรับสร้างโพสต์ใหม่
- `store(Request $request)`: ตรวจสอบข้อมูล (Validate) และบันทึกโพสต์ใหม่ลงฐานข้อมูล รวมถึงจัดการการอัปโหลดรูปภาพ
- `show(Post $post)`: แสดงรายละเอียดของโพสต์ที่เลือก พร้อมทั้งโหลดข้อมูลผู้เขียนและคอมเมนต์ต่างๆ
- `edit(Post $post)`: แสดงฟอร์มสำหรับแก้ไขโพสต์ โดยมีการตรวจสอบสิทธิ์ว่าเป็นเจ้าของโพสต์หรือไม่
- `update(Request $request, Post $post)`: ตรวจสอบข้อมูลและอัปเดตโพสต์ในฐานข้อมูล
- `destroy(Post $post)`: ลบโพสต์ออกจากฐานข้อมูล โดยมีการตรวจสอบสิทธิ์ก่อนลบ

---

## 4. Routing (เส้นทาง)

เส้นทางหรือ URL สำหรับเข้าถึงฟังก์ชันต่างๆ ของระบบโพสต์ถูกกำหนดไว้ในไฟล์ `routes/web.php` โดยใช้ `Route::resource` ซึ่งเป็นวิธีมาตรฐานของ Laravel ในการสร้าง CRUD routes ทั้งหมดโดยอัตโนมัติ

```php
// routes/web.php

// สร้าง routes สำหรับ CRUD ของ PostController
// GET /posts -> index()
// GET /posts/create -> create()
// POST /posts -> store()
// GET /posts/{post} -> show()
// GET /posts/{post}/edit -> edit()
// PUT/PATCH /posts/{post} -> update()
// DELETE /posts/{post} -> destroy()
Route::resource('posts', PostController::class);

// Route สำหรับหน้าแรกให้ไปที่รายการโพสต์
Route::get('/', [PostController::class, 'index'])->name('home');
```

นอกจากนี้ยังมี Route สำหรับจัดการคอมเมนต์:
- `POST /posts/{post}/comments`: สำหรับบันทึกคอมเมนต์ใหม่ (`comments.store`)
- `DELETE /comments/{comment}`: สำหรับลบคอมเมนต์ (`comments.destroy`)

---

## 6. เอกสารเชิงลึก (Detailed Documentation)

สำหรับข้อมูลเชิงลึกในแต่ละส่วนของสถาปัตยกรรม สามารถอ่านเพิ่มเติมได้ที่ไฟล์ด้านล่างนี้:

- **[เอกสารฐานข้อมูล (Database)](./readme-database.md)**: อธิบาย Schema ของตารางทั้งหมด
- **[เอกสารโมเดล (Models)](./readme-model.md)**: อธิบาย Eloquent Models และความสัมพันธ์
- **[เอกสารคอนโทรลเลอร์ (Controllers)](./readme-controller.md)**: อธิบายหน้าที่ของ Controllers หลัก
- **[เอกสารหน้าเว็บ (Pages/Views)](./readme-pages.md)**: อธิบายโครงสร้างและหน้าที่ของ Views

---

## 5. Views (หน้าแสดงผล)

ไฟล์ Views ที่ใช้แสดงผลสำหรับระบบโพสต์จะอยู่ใน `resources/views/posts/` และใช้ Blade Template Engine ของ Laravel ในการแสดงผลข้อมูลแบบไดนามิก

- **`index.blade.php`**
  - **หน้าที่:** แสดงรายการโพสต์ทั้งหมดจากฐานข้อมูล
  - **ฟีเจอร์หลัก:**
    - แสดงหัวข้อ, เนื้อหาบางส่วน, ชื่อผู้เขียน, และเวลาที่สร้างโพสต์
    - มีระบบแบ่งหน้า (Pagination) เพื่อจัดการกับโพสต์จำนวนมาก
    - ผู้ใช้ที่ล็อกอินแล้วจะเห็นปุ่ม "สร้างกระทู้ใหม่"
    - เจ้าของโพสต์จะเห็นปุ่ม "แก้ไข" และ "ลบ" โพสต์ของตนเอง

- **`show.blade.php`**
  - **หน้าที่:** แสดงรายละเอียดทั้งหมดของโพสต์ที่เลือก
  - **ฟีเจอร์หลัก:**
    - แสดงหัวข้อ, เนื้อหาทั้งหมด, และรูปภาพประกอบ (ถ้ามี)
    - แสดงรายการความคิดเห็น (Comments) ทั้งหมดที่เกี่ยวกับโพสต์นั้นๆ
    - ผู้ใช้ที่ล็อกอินแล้วสามารถส่งความคิดเห็นใหม่ผ่านฟอร์มได้
    - เจ้าของความคิดเห็นสามารถลบคอมเมนต์ของตนเองได้

- **`create.blade.php`**
  - **หน้าที่:** แสดงฟอร์มสำหรับให้ผู้ใช้สร้างโพสต์ใหม่
  - **ฟีเจอร์หลัก:**
    - มีฟิลด์สำหรับกรอก `หัวข้อ`, `เนื้อหา`, และอัปโหลด `รูปภาพ`
    - ผู้ใช้ที่ยังไม่ได้ล็อกอินจะเห็นข้อความแจ้งเตือนให้ล็อกอินก่อน

- **`edit.blade.php`** (ไฟล์นี้มีอยู่เพื่อรองรับฟังก์ชันแก้ไข)
  - **หน้าที่:** แสดงฟอร์มสำหรับแก้ไขโพสต์ที่มีอยู่แล้ว
  - **ฟีเจอร์หลัก:**
    - ดึงข้อมูลเดิมของโพสต์มาแสดงในฟอร์มเพื่อให้ผู้ใช้แก้ไขได้
    - Controller จะตรวจสอบสิทธิ์ก่อนว่าผู้ใช้เป็นเจ้าของโพสต์หรือไม่จึงจะแสดงหน้านี้ได้
